<ion-header>
  <app-toolbar [page]="this">
  </app-toolbar>
</ion-header>

<ion-content appScrollbarTheme class="ion-padding">
  <div class="main-view" *ngIf="item && pageConfig.showSpinner==false">
    <ion-grid fixed>
      <form [formGroup]="formGroup">
        <ion-row class="hr-group">
          <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
            <ion-list-header class="ion-no-padding">
              <ion-label color="primary">{{'Production Order' | translate}}</ion-label>
            </ion-list-header>
          </ion-col>

          <ion-col size="12" size-sm size-xl="4">
            <!-- <app-form-control
              [field]="{id:'Type', label: 'Type', type : 'ng-select', form : formGroup,  dataSource: typeList,  bindLabel: 'Name',  bindValue: 'Code' }"
              (change)="saveChange()">
            </app-form-control>

            <app-form-control
              [field]="{id:'Status', label: 'Status', type : 'ng-select', form : formGroup,  dataSource: statusList,  bindLabel: 'Name',  bindValue: 'Code' }"
              (change)="saveChange()">
            </app-form-control> -->

            <app-form-control [field]="{id:'IDBOM', label: 'BOM', type : 'text', form : formGroup }"
              (change)="saveChange()">
            </app-form-control>

            <app-form-control
              [field]="{id:'PlannedQuantity', label: 'Planned quantity', type : 'number', form : formGroup }"
              (change)="saveChange()">
            </app-form-control>

            <div class="c-control">
              <label class="c-label" for="IDWarehouse">{{'erp.app.pages.purchase.purchase-order.id-branch' | translate}}
                <span
                  *ngIf="!formGroup.controls.IDWarehouse.valid && !formGroup.controls.IDWarehouse.pending && (formGroup.controls.IDWarehouse.dirty || submitAttempt)"
                  ion-text color="danger">(*)</span>
              </label>
              <ng-select class="c-input" (change)="changeWarehouse($event);" labelForId="IDWarehouse"
                formControlName="IDWarehouse" [items]="branchList" [virtualScroll]="true" bindLabel="Name"
                bindValue="Id" placeholder="{{'erp.app.pages.purchase.purchase-order.search-placeholder' | translate}}">
                <ng-template ng-option-tmp let-i="item" let-search="searchTerm">
                  <div *ngIf="i">
                    <div> <span *ngFor="let l of i.levels">&nbsp;&nbsp;&nbsp;</span> <span
                        [ngOptionHighlight]="search">{{i.Name}}</span></div>
                  </div>
                </ng-template>
              </ng-select>
            </div>

            <app-form-control
              [field]="{id:'OrderDate', label: 'Order date', type : 'datetime-local', placeholder: 'yyyy-MM-dd', form : formGroup }"
              (change)="saveChange()">
            </app-form-control>

          </ion-col>

          <ion-col size="12" size-sm size-xl="4">
            <app-form-control
              [field]="{id:'StartDate', label: 'Start date', type : 'datetime-local', placeholder: 'yyyy-MM-dd', form : formGroup }"
              (change)="saveChange()">
            </app-form-control>
            <app-form-control
              [field]="{id:'DueDate', label: 'Due date', type : 'datetime-local', placeholder: 'yyyy-MM-dd', form : formGroup }"
              (change)="saveChange()">
            </app-form-control>
            <app-form-control [field]="{id:'IDSaleOrder', label: 'SalesOrder', type : 'text', form : formGroup }"
              (change)="saveChange()">
            </app-form-control>
            <app-form-control
              [field]="{id:'IDCustomer', label: 'Customer', type : 'ng-select-bp', form : formGroup,  dataSource: IDBusinessPartnerDataSource,  bindValue: 'Id' }"
              (change)="IDBusinessPartnerChange($event);" (nav)="nav($event)">
            </app-form-control>
            <app-form-control [field]="{id:'PickRemark', label: 'Pick & Pack remark', type : 'text', form : formGroup }"
              (change)="saveChange()">
            </app-form-control>
          </ion-col>
        </ion-row>
      </form>
    </ion-grid>
    <app-page-message [itemsLength]="item? 1: 0" [showSpinner]="pageConfig.showSpinner"></app-page-message>
    <div class="row-full shadow full-screen">
      <ion-toolbar color="primary">
        <ion-segment scrollable="true" (ionChange)="segmentChanged($event)" [value]="segmentView">
          <ion-segment-button value="s1">
            <ion-label>{{'Components' | translate }}</ion-label>
          </ion-segment-button>
          <ion-segment-button value="s2">
            <ion-label>{{'Other information' | translate}}</ion-label>
          </ion-segment-button>
        </ion-segment>
      </ion-toolbar>

      <div class="table-contain" *ngIf="segmentView == 's1'">

          <section class="table responsive">

            <header class="bold">
              <div class="col-checkbox cell">
                <input (change)="toggleSelectAll()" [(ngModel)]="isAllChecked" class="c-checkbox" type="checkbox">
              </div>
              <div class="col-id cell">#</div>

              <div class="col-name cell">
                {{'Name' | translate}}
              </div>

              <div class="col-uom cell">
                {{'Type' | translate}}
              </div>
              <div class="col-date cell">
                {{'Start date' | translate}}
              </div>

              <div class="col-date cell">
                {{'End date' | translate}}
              </div>

              <div class="col-qty cell">
                {{'Production time' | translate}}
              </div>

              <div class="col-qty cell">
                {{'Base qty' | translate}}
              </div>

              <div class="col-qty cell">
                {{'Planned qty' | translate}}
              </div>

              <div class="col-status cell">
                {{'Issue method' | translate}}
              </div>

              <div class="col-status cell">
                {{'Status' | translate}}
              </div>
              <div class="col-icon cell">
                  
              </div>
            </header>
            <app-page-message [itemsLength]="formGroup.get('ProductionOrderDetails')['controls']"
              [showSpinner]="pageConfig.showSpinner"></app-page-message>
            <ng-container *ngIf="!pageConfig.showSpinner">
              <div *ngFor="let c of formGroup.get('ProductionOrderDetails')['controls'] ;let j = index" class="row"
                [ngClass]="{odd: j % 2 != 0}">
                <div class="col-checkbox cell" style="text-align: center;">
                  <app-input-control [field]="{id:'IsChecked', type : 'checkbox', form : c, }"
                    (change)="changeSelection(c,'main', $event)"></app-input-control>
                </div>
                <div class="col-id cell">{{j+1}}</div>

                <div class="col-name cell">
                  <div *ngIf="c.get('IDItem')?.value">
                    <a [routerLink]="['/item/'+c.get('IDItem').value]"
                      (mousedown)="$event.stopPropagation()">#{{c.get('IDItem').value}} <ion-icon
                        name="open-outline"></ion-icon></a>
                    <span [title]="c.get('ItemName')?.value"> {{c.get('ItemName').value}}</span>
                  </div>
                 
                </div>
                <div class="col-uom cell">
                  {{c.get('Type')?.value}}
                </div>

                <div class="col-date cell">
                  {{c.get('StartDate')?.value}}
                </div>

                <div class="col-date cell">
                  {{c.get('EndDate')?.value}}
                </div>

                <div class="col-qty cell">
                  {{c.get('RequiredDays')?.value}}
                </div>

                <div class="col-qty cell">
                  {{c.get('BaseQuantity')?.value}}
                </div>

                <div class="col-qty cell">
                  {{c.get('PlannedQuantity')?.value}}
                </div>

                <div class="col-status cell">
                  {{c.get('IssueMethod')?.value}}
                </div>

                <div class="col-status cell">
                  {{c.get('Status')?.value}}
                </div>

                <div class="col-icon cell" (click)="removeField(c,j)" clickable>
                  
                </div>
              </div>
            </ng-container>

          </section>
     
      </div>
      <div *ngIf="segmentView == 's2'">
        <div class="ion-padding">
          <ion-grid fixed>
            <form [formGroup]="formGroup">
              <ion-row class="hr-group">
                <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                  <ion-list-header class="ion-no-padding">
                    <ion-label color="primary">{{'Group Cost' | translate}}</ion-label>
                  </ion-list-header>
                </ion-col>
                <ion-col size="12" size-sm size-xl="4">
                  <app-form-control
                    [field]="{id:'ItemComponentCost', label: 'Item component cost', type : 'text', bindValue: 'TaxCode', form : formGroup }"
                    (change)="saveChange()"></app-form-control>
                  <app-form-control
                    [field]="{id:'ResourceComponentCost', label: 'Resource component cost', type : 'text', form : formGroup }"
                    (change)="saveChange()"></app-form-control>
                  <app-form-control [field]="{id:'AdditionCost', label: 'Addition cost', type : 'text', form : formGroup }"
                    (change)="saveChange()"></app-form-control>
                </ion-col>
                <ion-col size="12" size-sm size-xl="4">
                  <app-form-control
                    [field]="{id:'ProductCost', label: 'Product cost', type : 'text', bindValue: 'TaxCode', form : formGroup }"
                    (change)="saveChange()"></app-form-control>
                  <app-form-control
                    [field]="{id:'TotalCost', label: 'Total cost', type : 'text', form : formGroup }"
                    (change)="saveChange()"></app-form-control>
                  <app-form-control [field]="{id:'JournalRemark', label: 'Journal remark', type : 'text', form : formGroup }"
                    (change)="saveChange()"></app-form-control>
                </ion-col>
              </ion-row>
            
            <ion-row class="hr-group">
              <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                <ion-list-header class="ion-no-padding">
                  <ion-label color="primary">{{'Group Quantity' | translate}}</ion-label>
                </ion-list-header>
              </ion-col>
              <ion-col size="12" size-sm size-xl="4">
                <app-form-control
                  [field]="{id:'PlannedQuantity', label: 'Planned quantity', type : 'number', form : formGroup }"
                  (change)="saveChange()"></app-form-control>
                <app-form-control
                  [field]="{id:'CompletedQuantity', label: 'Completed quantity', type : 'number', form : formGroup }"
                  (change)="saveChange()"></app-form-control>
                <app-form-control
                  [field]="{id:'RejectedQuantity', label: 'Rejected quantity', type : 'number', form : formGroup }"
                  (change)="saveChange()"></app-form-control>
              </ion-col>
            </ion-row>
            <ion-row class="hr-group">
              <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                <ion-list-header class="ion-no-padding">
                  <ion-label color="primary">{{'Group Dates' | translate}}</ion-label>
                </ion-list-header>
              </ion-col>
              <ion-col size="12" size-sm size-xl="4">
                <app-form-control
                  [field]="{id:'DueDate', label: 'Due date', type : 'datetime-local', form : formGroup }"
                  (change)="saveChange()"></app-form-control>
                <app-form-control
                  [field]="{id:'ActualClosingDate', label: 'Actual closing date', type : 'datetime-local', form : formGroup }"
                  (change)="saveChange()"></app-form-control>
                <app-form-control
                  [field]="{id:'Overdue', label: 'Overdue', type : 'datetime-local', form : formGroup }"
                  (change)="saveChange()"></app-form-control>
              </ion-col>
            </ion-row>
            </form>
            <!-- Other information -->
            <ion-row class="hr-group" *ngIf="item.Id">
              <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                <ion-list-header class="ion-no-padding">
                  <ion-label color="primary">{{'Other information' | translate}}</ion-label>
                </ion-list-header>
              </ion-col>
              <ion-col size="12" size-sm size-xl="4">
                <app-form-control
                  [field]="{id:'CreatedBy', type : 'text', label: 'Created by', form : formGroup }"
                ></app-form-control>
                <app-form-control
                  [field]="{id:'CreatedDate', type : 'span-datetime', label: 'Created date', form : formGroup }"
                ></app-form-control>
                <app-form-control
                  [field]="{id:'ModifiedBy', type : 'text', label: 'Last modified by', form : formGroup }"
                ></app-form-control>
                <app-form-control
                  [field]="{id:'ModifiedDate', type : 'span-datetime', label: 'Last modified date', form : formGroup }"
                ></app-form-control>
              </ion-col>
              <ion-col size="12" size-sm size-xl="4">
                <app-form-control
                  [field]="{id:'IDBranch', type : 'branch-breadcrumbs', label: 'Branch', form : formGroup, dataSource:env.branchList }"
                ></app-form-control>
                <app-form-control
                  [field]="{id:'Remark', type : 'textarea', label: 'Remark', form : formGroup }"
                  (change)="saveChange()"
                ></app-form-control>
              </ion-col>
            </ion-row>
          </ion-grid>
        </div>
      </div>


    </div>

  </div>
  <app-page-message [itemsLength]="item? 1: 0" [showSpinner]="pageConfig.showSpinner"></app-page-message>
</ion-content>